# Story 1.3: Implement Category CRUD API

## Status
Ready

## Story
**As a** developer,
**I want** to create API endpoints for managing `Category` data,
**so that** categories can be created, retrieved, updated, and deleted from the database.

## Acceptance Criteria
1.  A `Category` data class is defined in the `shared` module to be used by both client and server.
2.  The Ktor server exposes RESTful endpoints at a `/categories` path.
3.  The following endpoints are implemented:
    *   `POST /categories`: Creates a new category.
    *   `GET /categories`: Retrieves all categories.
    *   `GET /categories/{id}`: Retrieves a single category by its ID.
    *   `PUT /categories/{id}`: Updates an existing category.
    *   `DELETE /categories/{id}`: Deletes a category.
4.  Each endpoint correctly performs the corresponding Create, Read, Update, or Delete operation in the PostgreSQL database.
5.  Server-side validation is implemented:
    *   All category IDs must be handled as UUIDs.
    *   The `name` for a category cannot be empty.
6.  The functionality is covered by automated tests.

## Tasks / Subtasks
- [ ] Define `Category` data class in `shared` module (AC: 1)
    - [ ] Create `Category.kt` in `shared/src/commonMain/kotlin/com/example/mygroceries/model/` [Source: architecture/8-source-tree.md]
    - [ ] Implement `id` as UUID and `name` as String [Source: architecture/4-data-models.md]
    - [ ] Annotate with `@Serializable` [Source: architecture/4-data-models.md]
- [ ] Implement Category repository/DAO for database operations (AC: 4)
    - [ ] Create `CategoryRepository.kt` in `server/src/main/kotlin/com/example/mygroceries/db/` [Source: architecture/8-source-tree.md]
    - [ ] Implement `create`, `readAll`, `readById`, `update`, `delete` functions using Exposed [Source: architecture/3-tech-stack.md]
- [ ] Implement Category service layer (AC: 4)
    - [ ] Create `CategoryService.kt` in `server/src/main/kotlin/com/example/mygroceries/db/`
    - [ ] Inject `CategoryRepository`
    - [ ] Implement business logic for CRUD operations, including validation (AC: 5)
        - [ ] Validate `name` is not empty [Source: Epic 1.3 AC 5]
        - [ ] Ensure IDs are handled as UUIDs [Source: Epic 1.3 AC 5]
- [ ] Implement Category API routes (AC: 2, 3)
    - [ ] Create `CategoryRoutes.kt` in `server/src/main/kotlin/com/example/mygroceries/routes/` [Source: architecture/8-source-tree.md]
    - [ ] Define `POST /categories` endpoint for creating categories [Source: architecture/6-rest-api-spec.md]
    - [ ] Define `GET /categories` endpoint for retrieving all categories [Source: architecture/6-rest-api-spec.md]
    - [ ] Define `GET /categories/{id}` endpoint for retrieving a single category by ID [Source: architecture/6-rest-api-spec.md]
    - [ ] Define `PUT /categories/{id}` endpoint for updating an existing category [Source: architecture/6-rest-api-spec.md]
    - [ ] Define `DELETE /categories/{id}` endpoint for deleting a category [Source: architecture/6-rest-api-spec.md]
    - [ ] Handle request/response serialization using Kotlinx Serialization [Source: architecture/3-tech-stack.md]
- [ ] Add unit tests for `CategoryService` (AC: 6)
    - [ ] Use Kotest and MockK [Source: architecture/9-test-strategy-and-standards.md]
    - [ ] Cover validation logic [Source: Epic 1.3 AC 5]
- [ ] Add integration tests for Category API endpoints (AC: 6)
    - [ ] Spin up in-memory Ktor application [Source: architecture/9-test-strategy-and-standards.md]
    - [ ] Test all CRUD endpoints (`POST`, `GET`, `PUT`, `DELETE`) [Source: architecture/6-rest-api-spec.md]
    - [ ] Verify database state changes [Source: architecture/9-test-strategy-and-standards.md]

## Dev Notes
- **Previous Story Insights**:
    - Database schema and connection are set up.
    - Monorepo structure with `shared`, `server`, `web`, `android`, and `ios` modules created.
    - Core dependencies (Ktor, Compose Multiplatform, PostgreSQL driver, Kotlinx Serialization) added and resolved.
    - `shared` module dependencies: Kotlinx Serialization, Ktor Client, Compose Multiplatform.
    - `server` module dependencies: `shared` module, Ktor Server, Exposed (DB driver), PostgreSQL.
- **Data Models**:
    - `Category`: `id`: UUID, `name`: String. One-to-Many with `Products`. [Source: architecture/4-data-models.md]
    - To be implemented as `@Serializable` data class in the `shared` module. [Source: architecture/4-data-models.md]
- **API Specifications**:
    - Ktor server exposes RESTful endpoints at `/categories`. [Source: architecture/6-rest-api-spec.md]
    - Endpoints: `GET /categories`, `POST /categories`, `GET /categories/{id}`, `PUT /categories/{id}`, `DELETE /categories/{id}`. [Source: architecture/6-rest-api-spec.md]
- **Component Specifications**: No specific guidance found in architecture docs.
- **File Locations**:
    - `Category` data class: `shared/src/commonMain/kotlin/com/example/mygroceries/model/` [Source: architecture/8-source-tree.md]
    - API route definitions: `server/src/main/kotlin/com/example/mygroceries/routes/` [Source: architecture/8-source-tree.md]
    - Database connection, migrations, repositories: `server/src/main/kotlin/com/example/mygroceries/db/` [Source: architecture/8-source-tree.md]
- **Technical Constraints**:
    - Language: Kotlin 1.9.23 [Source: architecture/3-tech-stack.md]
    - Core Framework: Kotlin Multiplatform 1.6.10 [Source: architecture/3-tech-stack.md]
    - Backend Framework: Ktor 2.3.9 [Source: architecture/3-tech-stack.md]
    - Database: PostgreSQL 15.x [Source: architecture/3-tech-stack.md]
    - Database Driver: Exposed 0.49.0 [Source: architecture/3-tech-stack.md]
    - Serialization: Kotlinx Serialization 1.6.3 [Source: architecture/3-tech-stack.md]

## Testing
- **Test file location**: Within each module's `commonTest` or `test` source set. [Source: architecture/9-test-strategy-and-standards.md]
- **Test standards**: All business logic in the `server` module must be covered by unit tests. All API endpoints defined in Epic 1 must have corresponding integration tests. [Source: architecture/9-test-strategy-and-standards.md]
- **Testing frameworks and patterns to use**: Kotest for assertions, MockK for mocking dependencies. Integration tests will spin up an in-memory or Testcontainers instance of the Ktor application and make real HTTP requests to the endpoints, asserting the responses and database state changes. [Source: architecture/9-test-strategy-and-standards.md]
- **Any specific testing requirements for this story**: Unit and integration tests for Category CRUD API.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-10-25 | 1.0 | Initial draft of Story 1.3 | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
