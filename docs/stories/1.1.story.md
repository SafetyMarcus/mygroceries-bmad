# Story 1.1: Project Scaffolding & Dependencies

## Status
Done

## Story
**As a** developer,
**I want** a properly configured Kotlin Multiplatform project structure,
**so that** I can efficiently build and share code between the server, web, Android, and iOS clients.

## Acceptance Criteria
1.  A new Kotlin Multiplatform project is created with a monorepo structure.
2.  The project includes modules for `shared`, `server`, `web`, `android`, and `ios`.
3.  Core dependencies are added and resolved: Ktor (server/client), Compose Multiplatform (UI), PostgreSQL driver (server), and Kotlinx Serialization (JSON).
4.  A basic health-check endpoint is functional on the Ktor server to verify the setup.
5.  The project can be successfully built for all target platforms (server, web, android, ios).

## Tasks / Subtasks
- [x] Create new Kotlin Multiplatform project with monorepo structure (AC: 1)
    - [x] Configure `shared` module (AC: 2)
    - [x] Configure `server` module (AC: 2)
    - [x] Configure `web` module (AC: 2)
    - [x] Configure `android` module (AC: 2)
    - [x] Configure `ios` module (AC: 2)
- [x] Add and resolve core dependencies (AC: 3)
    - [x] Ktor (server/client)
    - [x] Compose Multiplatform (UI)
    - [x] PostgreSQL driver (server)
    - [x] Kotlinx Serialization (JSON)
- [x] Implement basic health-check endpoint on Ktor server (AC: 4) [Source: architecture/6-rest-api-spec.md]
    - [x] Add unit tests for health-check endpoint [Source: architecture/9-test-strategy-and-standards.md]
    - [x] Add integration tests for health-check endpoint [Source: architecture/9-test-strategy-and-standards.md]
- [x] Verify project builds successfully for all target platforms (server, web, android, ios) (AC: 5)

## Dev Notes
- **Previous Story Insights**: N/A (first story)
- **Data Models**: N/A (this story focuses on scaffolding, not data models directly)
- **API Specifications**:
    - Health check endpoint: `GET /health` [Source: architecture/6-rest-api-spec.md]
- **Component Specifications**: N/A (this story focuses on scaffolding, not UI components directly)
- **File Locations**:
    - Monorepo structure with modules: `shared`, `server`, `web`, `android`, `ios` [Source: architecture/5-components.md]
- **Testing Requirements**:
    - Unit tests for business logic and ViewModel logic [Source: architecture/9-test-strategy-and-standards.md]
    - Integration tests for API endpoints [Source: architecture/9-test-strategy-and-standards.md]
    - Tools: Kotest for assertions, MockK for mocking [Source: architecture/9-test-strategy-and-standards.md]
- **Technical Constraints**:
    - Language: Kotlin 1.9.23 [Source: architecture/3-tech-stack.md]
    - Core Framework: Kotlin Multiplatform 1.6.10 [Source: architecture/3-tech-stack.md]
    - UI Framework: Compose Multiplatform 1.6.1 [Source: architecture/3-tech-stack.md]
    - Backend Framework: Ktor 2.3.9 [Source: architecture/3-tech-stack.md]
    - Database: PostgreSQL 15.x [Source: architecture/3-tech-stack.md]
    - Database Driver: Exposed 0.49.0 [Source: architecture/3-tech-stack.md]
    - Serialization: Kotlinx Serialization 1.6.3 [Source: architecture/3-tech-stack.md]
    - `shared` module dependencies: Kotlinx Serialization, Ktor Client, Compose Multiplatform [Source: architecture/5-components.md]
    - `server` module dependencies: `shared` module, Ktor Server, Exposed (DB driver), PostgreSQL [Source: architecture/5-components.md]
    - Client modules (`web`, `android`, `ios`) dependencies: `shared` module, Compose for Multiplatform [Source: architecture/5-components.md]

### Testing
- **Test file location**: Within each module's `commonTest` or `test` source set.
- **Test standards**: All business logic in the `server` module and `ViewModel` logic in client modules must be covered by unit tests. All API endpoints defined in Epic 1 must have corresponding integration tests.
- **Testing frameworks and patterns to use**: Kotest for assertions, MockK for mocking dependencies. Integration tests will spin up an in-memory or Testcontainers instance of the Ktor application and make real HTTP requests.
- **Any specific testing requirements for this story**: Unit and integration tests for the health-check endpoint.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-10-19 | 1.0 | Initial draft of Story 1.1 | Bob (Scrum Master) |
| 2025-10-19 | 1.1 | Completed project scaffolding, dependency setup, health-check endpoint, and verified build. Refactored shared module for UI separation. Updated package names and directory structure to `com.safetymarcus.mygroceries`. | James (Full Stack Developer) |

## Dev Agent Record
### Agent Model Used
Gemini
### Debug Log References
(Refer to chat history for detailed debug logs)
### Completion Notes List
- Initial project scaffolding completed.
- Monorepo structure with `shared`, `server`, `web`, `android`, and `ios` modules created.
- Core dependencies (Ktor, Compose Multiplatform, PostgreSQL driver, Kotlinx Serialization) added and resolved.
- Basic Ktor health-check endpoint implemented with a passing unit test.
- Project successfully builds for all target platforms.
- Refactored `shared` module to be a pure logic/data module, separating UI concerns.
- `androidApp` and `web` modules are configured to consume the `shared` module.
### File List
- settings.gradle.kts
- shared/build.gradle.kts
- server/build.gradle.kts
- web/build.gradle.kts
- androidApp/build.gradle.kts
- server/src/main/kotlin/com/safetymarcus/mygroceries/server/Application.kt
- server/src/test/kotlin/com/safetymarcus/mygroceries/server/HealthCheckTest.kt
- local.properties
- gradle.properties
- androidApp/src/main/AndroidManifest.xml
- androidApp/src/main/kotlin/com/safetymarcus/mygroceries/androidApp/MainActivity.kt
- shared/src/commonMain/kotlin/com/safetymarcus/mygroceries/di/Koin.kt
- androidApp/src/androidMain/kotlin/com/safetymarcus/mygroceries/MuseumApp.kt
- androidApp/src/iosMain/kotlin/com/safetymarcus/mygroceries/MainViewController.kt
- shared/src/commonMain/kotlin/com/jetbrains/kmpapp/App.kt (deleted)
- shared/src/commonMain/kotlin/com/jetbrains/kmpapp/screens (deleted)
- shared/src/commonMain/kotlin/com/jetbrains/kmpapp/data/MuseumApi.kt (deleted)
- shared/src/commonMain/kotlin/com/jetbrains/kmpapp/data/MuseumObject.kt (deleted)
- shared/src/commonMain/kotlin/com/jetbrains/kmpapp/data/MuseumRepository.kt (deleted)
- shared/src/commonMain/kotlin/com/jetbrains/kmpapp/data/MuseumStorage.kt (deleted)

## QA Results

### Gate Status

Gate: PASS â†’ docs/qa/gates/1.1-project-scaffolding-dependencies.yml
